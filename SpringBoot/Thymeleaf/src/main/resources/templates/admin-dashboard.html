<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>

    <head th:replace="~{fragments/layout :: page_head}"></head>
    <title>Admin Dashboard</title>
</head>

<body>
    <header>
        <h1>Demo Spring Security</h1>
        <hr />
    </header>

    <main>
        <a th:href="@{/}">Về trang chủ</a>

        <div style="margin-top: 20px; padding: 15px; background-color: #eef;">
            <h3>Thông tin người dùng hiện tại (lấy từ SecurityContextHolder)</h3>
            <p><strong>Username:</strong> <span th:text="${username}"></span></p>
            <p><strong>Authorities:</strong> <span th:text="${authorities}"></span></p>
        </div>

        <!-- Hiển thị thông báo thành công hoặc lỗi từ RedirectAttributes -->
        <div th:if="${message}" class="success-message"
            style="color: green; background-color: #dff0d8; padding: 15px; margin-top: 15px;">
            <p th:text="${message}"></p>
        </div>
        <div th:if="${error}" class="error-summary">
            <p th:text="${error}"></p>
        </div>

        <div style="margin-top: 20px;">
            <h3>Kiểm tra Method Security</h3>
            <p>Hãy thử các chức năng dưới đây với các tài khoản khác nhau (admin, user, manager) để xem kết quả.</p>
            <ul>
                <li>
                    <a th:href="@{/admin/save-product}">1. Gọi saveProduct()</a>
                    - Yêu cầu: `hasAuthority('product:write')` hoặc `hasRole('ADMIN')`. (Admin: OK, User/Manager: Thất
                    bại)
                </li>
                <li>
                    <a th:href="@{/admin/profile/user}">2. Xem profile của 'user'</a>
                    - Yêu cầu: `tên đăng nhập == 'user'` hoặc `hasRole('ADMIN')`. (Manager đăng nhập: Thất bại,
                    User/Admin đăng nhập: OK)
                </li>
                <li>
                    <a th:href="@{/admin/profile/admin}">3. Xem profile của 'admin'</a>
                    - Yêu cầu: `tên đăng nhập == 'admin'`. (Admin đăng nhập: OK, User/Manager đăng nhập: Thất bại)
                </li>
                <li>
                    <a th:href="@{/admin/product/1}">4. Lấy sản phẩm có chủ là 'admin'</a>
                    - Yêu cầu: `chủ sản phẩm == tên đăng nhập`. (Admin đăng nhập: OK, User/Manager đăng nhập: Thất bại)
                </li>
                <li>
                    <a th:href="@{/admin/admin-task}">5. Thực hiện Admin Task</a>
                    - Yêu cầu: `@Secured("ROLE_ADMIN")`. (Admin: OK, User/Manager: Thất bại)
                </li>
                <li>
                    <a th:href="@{/admin/manager-task}">6. Thực hiện Manager Task</a>
                    - Yêu cầu: `@RolesAllowed("MANAGER")`. (Manager: OK, User/Admin: Thất bại)
                </li>
            </ul>
        </div>
    </main>
</body>

</html>